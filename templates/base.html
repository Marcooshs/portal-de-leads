<!doctype html>
{% load static %}
<html lang="pt-br" x-data="theme()" :data-bs-theme="dark ? 'dark' : 'light'">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}CRM Leads{% endblock %}</title>

  <!-- Bootstrap 5 + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

  <!-- ====== ESTILOS (light/dark otimizados) ====== -->
  <style>
    /* ====== Tokens de cor (Light por padrão) ====== */
    :root{
      /* Paleta principal */
      --brand-start: #5b3abf;   /* roxo levemente dessaturado p/ light */
      --brand-mid:   #3867ff;   /* azul */
      --brand-end:   #1fcde2;   /* ciano */
      --accent:      #ff6b6b;

      /* Superfícies/vidro (light) */
      --surface:      rgba(255,255,255,.80);
      --glass-border: rgba(0,0,0,.08);

      /* Intensidades light */
      --bg1: rgba(111,66,193,.12);
      --bg2: rgba(63,124,255,.12);
      --bg3: rgba(34,209,238,.12);
      --table-hover: rgba(56,103,255,.06);
      --focus-ring-1: rgba(56,103,255,.22);
      --focus-ring-2: rgba(31,205,226,.18);
    }

    /* Overrides para o modo escuro */
    [data-bs-theme="dark"]{
      --surface:      rgba(22,22,26,.58);
      --glass-border: rgba(255,255,255,.12);

      /* No escuro o fundo precisa um pouco mais de “força” */
      --bg1: rgba(111,66,193,.22);
      --bg2: rgba(63,124,255,.22);
      --bg3: rgba(34,209,238,.22);
      --table-hover: rgba(63,124,255,.12);
      --focus-ring-1: rgba(99,102,241,.35);
      --focus-ring-2: rgba(34,209,238,.25);
    }

    /* ====== Fundo com gradientes suaves por tema ====== */
    body{
      background:
        radial-gradient(1200px 600px at -10% -20%, var(--bg1), transparent 60%),
        radial-gradient(1000px 500px at 110% -10%, var(--bg2), transparent 60%),
        radial-gradient(900px 400px at 50% 120%, var(--bg3), transparent 60%);
      background-color: transparent;
    }

    /* Utilidades visuais */
    .bg-brand-gradient{
      background: linear-gradient(135deg, var(--brand-start), var(--brand-mid), var(--brand-end));
    }
    .text-brand-gradient{
      background: linear-gradient(90deg, var(--brand-start), var(--brand-end));
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    .glass{
      background: var(--surface);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
    }
    .soft-shadow{ box-shadow: 0 10px 30px rgba(0,0,0,.12); }
    .hover-lift{ transition: transform .15s ease, box-shadow .15s ease; }
    .hover-lift:hover{ transform: translateY(-2px); box-shadow: 0 14px 36px rgba(0,0,0,.16); }

    .btn-gradient{
      background: linear-gradient(135deg, var(--brand-mid), var(--brand-end));
      border: 0; color: #fff;
      transition: filter .2s ease, transform .08s ease;
    }
    .btn-gradient:hover{ filter: brightness(1.05); }
    .btn-gradient:active{ transform: translateY(1px) scale(.98); }

    .ring-focus:focus{
      box-shadow: 0 0 0 .22rem var(--focus-ring-1), 0 0 0 .38rem var(--focus-ring-2);
      outline: none;
    }
    .form-control:focus, .form-select:focus{ box-shadow: 0 0 0 .22rem var(--focus-ring-1); }

    /* Tabela */
    .table thead th{ position: sticky; top: 0; z-index: 1; }
    .table-hover tbody tr:hover{ background: var(--table-hover); }

    /* Badges de status (funciona bem nos dois temas) */
    .badge-soft{ border:1px solid transparent; }
    .badge-new{ background: rgba(13,110,253,.12); color:#0d6efd; border-color: rgba(13,110,253,.25); }
    .badge-qlf{ background: rgba(13,202,240,.12); color:#0dcaf0; border-color: rgba(13,202,240,.25); }
    .badge-won{ background: rgba(24,201,100,.15); color:#18c964; border-color: rgba(24,201,100,.25); }
    .badge-lst{ background: rgba(220,53,69,.12); color:#dc3545; border-color: rgba(220,53,69,.25); }
    .badge-cld{ background: rgba(108,117,125,.14); color:#6c757d; border-color: rgba(108,117,125,.25); }

    /* Navbar com linha neon */
    #topbar{ border:0; border-bottom: 2px solid transparent; }
    #topbar::after{
      content:""; display:block; height:2px; width:100%;
      background: linear-gradient(90deg, var(--brand-start), var(--brand-end));
    }

    /* FAB (botão flutuante) */
    .fab{
      position: fixed; right: 24px; bottom: 24px; z-index: 1055;
      width: 56px; height: 56px; display:flex; align-items:center; justify-content:center;
    }

    /* Indicador de loading */
    .ring{
      width:22px; height:22px; border-radius:50%;
      background:
        conic-gradient(from 0deg, var(--brand-end), var(--brand-mid), var(--brand-start), transparent 70%);
      -webkit-mask: radial-gradient(farthest-side, #0000 60%, #000 61%);
      animation: ringSpin 1s linear infinite;
      display:none;
    }
    .htmx-request .ring{ display:inline-block!important; }
    @keyframes ringSpin{ to{ transform: rotate(360deg); } }

    .toast-container { z-index: 1080; }
    [hx-indicator].htmx-request{ opacity:.65; pointer-events:none; }
  </style>

  {% block extra_head %}{% endblock %}
</head>
<body class="d-flex flex-column min-vh-100">
  {% include "partials/_navbar.html" %}

  <main class="container py-4" id="page-main">
    {% include "partials/_messages.html" %}
    {% block content %}{% endblock %}
  </main>

  <footer class="mt-auto py-4">
    <div class="container small d-flex justify-content-between align-items-center glass rounded-3 p-3 soft-shadow">
      <span>© {% now "Y" %} • <span class="text-brand-gradient fw-semibold">CRM Leads</span></span>
      <a href="?format=csv" class="btn btn-sm btn-outline-secondary hover-lift">
        <i class="bi bi-filetype-csv"></i> Exportar CSV (lista atual)
      </a>
    </div>
  </footer>

  <!-- HTMX/Alpine/Bootstrap -->
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <script src="https://unpkg.com/htmx.org@1.9.12/dist/ext/loading-states.js"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Alternância de tema com persistência
    function theme(){
      return {
        dark: localStorage.getItem('theme') === 'dark'
          || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches),
        toggle(){
          this.dark = !this.dark;
          localStorage.setItem('theme', this.dark ? 'dark' : 'light');
        }
      }
    }
    // Auto-exibir toasts das mensagens do Django
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.toast').forEach(t => new bootstrap.Toast(t).show());
    });
  </script>

  {% block extra_js %}{% endblock %}
</body>
</html>